<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studiekompisen SH - Åk 6 (Fullständig Skolbok)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- React & Babel for CDN usage -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 0; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 20px; border: 4px solid transparent; background-clip: content-box; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        #root { height: 100vh; display: flex; overflow: hidden; }
        .split-container { display: flex; flex-direction: column; height: 100%; width: 100%; overflow: hidden; }
        .panel-text { flex: 0 0 55%; min-height: 100px; overflow-y: auto; position: relative; background: white; }
        .drag-handle { 
            height: 12px; 
            background: #f8fafc; 
            cursor: ns-resize; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0;
            z-index: 40;
            touch-action: none;
        }
        .drag-handle::after { 
            content: ""; 
            width: 48px; 
            height: 4px; 
            background: #cbd5e1; 
            border-radius: 2px; 
        }
        .panel-ai { flex: 1; min-height: 100px; overflow-y: auto; background: #fafafa; display: flex; flex-direction: column; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .sidebar-transition { transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const MODEL = "gemini-2.0-flash"; // Stabilare modellnamn för produktion

        // --- DATA: ALLA 7 BLOCK (FULLSTÄNDIG SKOLBOKSTEXT) ---
        const BLOCKS = [
            {
                id: 1, title: "Block 1: Källkritik", icon: "sparkles", sections: [
                    {
                        title: "A: Skröna & Gustav Vasa", page: "8–9",
                        text: "Boksida: 8–9\n\nI ämnet historia läser du om hur det var förr i tiden. Vad hände i Sverige 1520 till exempel, när Gustav Eriksson irrade omkring i Dalarna, jagad av den danske kungen Kristian Tyranns soldater? Så här stod det i Läsebok för folkskolan – alla barn i hela Sverige läste förr om hur bonden Sven Elvsson i Isala i Dalarna räddade livet på Gustav Eriksson.\n\n'Sven Elvsson menade att Gustav nog inte var säker i Isala. Han gömde honom därför i ett stort halmlass och körde det uppåt de ödsliga skogarna. Snart mötte han några av danskarnas utskickade soldater. De misstänkte bonden och stack sina spjut några gånger genom halmlasset. En av spjutspetsarna rispade Gustav i benet, men han låg orörlig. Danskarna märkte ingenting och lät Sven Elvsson köra vidare. Snart såg Sven att blod började rinna ur halmlasset och färga snön. Sven blev rädd att blodet skulle avslöja dem. Han tog därför upp sin kniv, skar ett djupt hål i benet på hästen. När Sven sedan blev tillfrågad om blodfläckarna i snön, skyllde han på hästens sår.'\n\nVisst är det en spännande historia! Men är den sann? Gustav III beundrade Gustav Vasa och ville gärna visa att de var släkt. Kungen beordrade därför landshövdingen i Dalarna att hitta personer som kunde skriva ned Gustav Vasas 'äventyr'. Berättelserna skrevs alltså ner 250 år senare och kallas ofta för skrönor. En skröna kan ha en kärna av sanning men är sedan överdriven och förljugen. Källkritik hjälper oss att fråga: Vem berättar? Varför? Och när hände det?",
                        concepts: ["Källkritik", "Skröna", "Fakta", "Historiker", "Propaganda"],
                        mustKnow: ["Vad en skröna är.", "Att Vasa-berättelsen skrevs 250 år efteråt.", "Varför kungar använde historier för makt."],
                        summary: ["Källkritik granskar information.", "Skrönor är överdrivna historier.", "Vasa-berättelsen i Isala är en skröna."],
                        test: [{q: "Vad kallas en överdriven historia?", a: "Skröna"}, {q: "Vem beställde texten 250 år senare?", a: "Gustav III"}],
                        reasoning: "Varför ville en kung sprida hjältesagor om sina förfäder?",
                        application: "Hitta en rubrik på nätet och ställ källfrågorna."
                    },
                    {
                        title: "B: De 4 Källfrågorna", page: "10",
                        text: "Boksida: 10\n\nFör att granska en källa använder vi källkritik. Det finns fyra viktiga grundfrågor som du alltid ska ha med dig:\n\n1. Äkthet: Är källan vad den utger sig för att vara? Är det ett riktigt brev eller en falsk bild? I den digitala världen kan bilder och filmer enkelt ändras så att de ser äkta ut trots att de är fejk.\n\n2. Tid: När skapades källan? Det är bäst om den skapades precis när något hände. Ju längre tid som går, desto mer glömmer vi bort eller råkar ändra på detaljer i vår berättelse. En person som berättar om något idag som hände för 20 år sedan är inte lika pålitlig som en dagbok skriven samma dag.\n\n3. Beroende: Berättar källan något helt själv eller har den bara skrivit av någon annan? Om tre tidningar skriver samma sak men alla har tagit informationen från samma person, så finns det egentligen bara en enda källa.\n\n4. Syfte (Tendens): Vad vill författaren uppnå? Vill hen informera om sanningen, sälja något eller påverka dig? Om en källa är vinklad kallas det att den har en tendens.",
                        concepts: ["Äkthet", "Tid", "Beroende", "Tendens"],
                        mustKnow: ["De fyra källfrågorna.", "Tidens påverkan på minnet.", "Vad beroende innebär."],
                        summary: ["Äkthet, Tid, Beroende och Syfte.", "Information nära händelsen är bäst.", "Var vaksam på tendens."],
                        test: [{q: "Vilken är första källfrågan?", a: "Äkthet"}, {q: "Vad betyder tendens?", a: "Vinklad information"}],
                        reasoning: "Vilken fråga är svårast på internet?",
                        application: "Granska ett inlägg på sociala medier."
                    },
                    {
                        title: "C: Samhällsfrågan Läskskatt", page: "12",
                        text: "Boksida: 12\n\nEn samhällsfråga är en viktig fråga som diskuteras av många och där det finns olika uppfattningar. Man ska försöka se frågan från olika håll, ur olika perspektiv. Ett exempel är debatten om läskskatt.\n\nLäkare varnar för att fetma bland barn och unga har femdubblats sedan 1980-talet. De föreslog år 2021 att regeringen skulle införa en skatt på läsk för att få oss att dricka mindre socker. Läkarnas perspektiv är folkhälsan. Men det finns andra perspektiv. Vissa tycker att det är individens ansvar och att staten inte ska bestämma vad man dricker. Andra menar att en skatt slår hårdast mot de som redan har lite pengar. Samhällskunskap tränar oss i att förstå dessa krockar mellan olika intressen och se sambanden i samhället.",
                        concepts: ["Samhällsfråga", "Perspektiv", "Folkhälsa", "Värdering"],
                        mustKnow: ["Vad en samhällsfråga är.", "Att titta på en fråga ur olika perspektiv.", "Varför läkare vill ha läskskatt."],
                        summary: ["Samhällsfrågor berör många.", "Olika grupper ser frågorna på olika sätt.", "Läskskatt handlar om hälsa mot frihet."],
                        test: [{q: "Vad är en samhällsfråga?", a: "En fråga som diskuteras av många och har olika svar"}, {q: "Varför vill läkare ha skatt?", a: "Minska fetma bland unga"}],
                        reasoning: "Ska staten bestämma vad vi äter genom att höja priset?",
                        application: "Hitta en annan aktuell samhällsfråga i nyheterna."
                    }
                ]
            },
            {
                id: 2, title: "Block 2: Ekonomi", icon: "zap", sections: [
                    {
                        title: "A: Pengar & Historia", page: "43–44",
                        text: "Boksida: 43–44\n\nByteshandel har funnits så länge människan har funnits. Det betyder att man byter en vara mot en annan. Men det är krångligt att bära med sig tunga saker för att handla. För några tusen år sedan uppfanns därför pengar för att mäta värde.\n\nI Sverige var de första mynten av metall och de skulle vara värda precis lika mycket som själva metallen vägde. På 1600-talet blev det brist på guld och silver. Då började man använda koppar istället. Men koppar var billigare än guld, så mynten var tvungna att vara enormt stora och tunga. De tyngsta kopparmynten vägde över 19 kilo! Folk fick dra sina pengar på skottkärra till marknaden. År 1660 öppnade Johan Palmstruch den första banken i Stockholm. Han lät folk lämna in sina tunga mynt. Som bevis fick de ett kvitto på papper – dessa kvitton blev Sveriges första sedlar. Idag är de flesta pengar elektroniska digitala siffror.",
                        concepts: ["Byteshandel", "Metallen", "Johan Palmstruch", "Digitala pengar"],
                        mustKnow: ["Varför pengar uppfanns.", "Svenska mynt vägde 19 kg.", "Första banken 1660."],
                        summary: ["Pengar ersatte krånglig byteshandel.", "Första sedlarna var bankkvitton.", "Idag är pengar främst digitala."],
                        test: [{q: "Vad vägde tunga mynt?", a: "19 kg"}, {q: "Vem startade första banken?", a: "Johan Palmstruch"}],
                        reasoning: "Vad händer om internet slutar funka?",
                        application: "Designa ett eget mynt."
                    },
                    {
                        title: "B: Varor & Tjänster", page: "44-45",
                        text: "Boksida: 44-45\n\nEkonomi handlar om hur vi använder resurser för att köpa och sälja. Vi delar upp det vi handlar i varor och tjänster. En vara är en fysisk sak som du kan ta på, till exempel en cykel, en glass eller ett par skor. När du köper en vara äger du den saken. En tjänst är något som någon gör för dig. Exempel på tjänster är när en frisör klipper ditt hår, när en läkare undersöker dig eller när någon lagar din cykel. Du betalar för arbetet som utförs. Förr tillverkade vi nästan allt själva på gårdarna. Idag köper vi de flesta varor i affärer och vi köper många tjänster för att underlätta vardagen. Hela vår ekonomi bygger på att vi byter varor och tjänster med varandra.",
                        concepts: ["Vara", "Tjänst", "Resurs", "Lön"],
                        mustKnow: ["Skillnaden på vara och tjänst.", "Att arbete ger lön.", "Hur vi köper mer tjänster idag än förr."],
                        summary: ["Varor är saker, tjänster är arbete.", "Vi äger varor vi köper.", "Tjänster underlättar vår vardag."],
                        test: [{q: "Vad är en vara?", a: "En sak man kan ta på"}, {q: "Ge exempel på en tjänst.", a: "Klippa håret"}],
                        reasoning: "Varför köper vi mer tjänster idag än för 100 år sedan?",
                        application: "Lista 3 varor och 3 tjänster din familj betalat för nyligen."
                    },
                    {
                        title: "C: Brutto, Netto & Skatt", page: "46–47",
                        text: "Boksida: 46–47\n\nNär en person arbetar får hen lön. Men man får inte behålla alla pengar själv. Bruttolön är lönen före skatten är dragen. I Sverige betalar vi inkomstskatt till staten och kommunen, ofta ca 30%. Om Jan tjänar 30 000 kr i bruttolön dras ca 9 000 kr i skatt. Det som blir kvar kallas nettolön. Det är nettolönen man använder för att betala mat och hyra. \n\nSkattepengarna går till den offentliga sektorn. Det är saker vi äger tillsammans. Det betalar för skolor, lärare, sjukhus, poliser och vägar. Det betalar också för domstolar och försvaret. Utöver lön kan ett hushåll få bidrag, som barnbidrag som föräldrar får varje månad. Genom skatten kan vi ha en bra service som fungerar för alla, oavsett inkomst.",
                        concepts: ["Bruttolön", "Nettolön", "Offentlig sektor", "Inkomstskatt"],
                        mustKnow: ["Brutto vs Netto.", "Skatten är ca 30%.", "Vad skatten betalar."],
                        summary: ["Bruttolön = före skatt, Netto = efter skatt.", "Skatten betalar skola och vård.", "Den offentliga sektorn är gemensam."],
                        test: [{q: "Vad kallas lönen före skatt?", a: "Bruttolön"}, {q: "Vart går skatten?", a: "Offentlig sektor"}],
                        reasoning: "Varför betalar vi inkomstskatt?",
                        application: "Räkna ut netto om brutto är 100 kr."
                    }
                ]
            },
            {
                id: 3, title: "Block 3: Banker & Priser", icon: "landmark", sections: [
                    {
                        title: "A: Banken & Ränta", page: "52-53",
                        text: "Boksida: 52-53\n\nBanker fungerar som en mellanhand mellan sparare och lånare. De pengar som en bank har kommer från människor och företag som sparar. När du sätter in pengar lånar du ut dem till banken. Banken samlar ihop pengar från många sparare och lånar ut dem till andra, till exempel till familjer som vill köpa hus. Banken tjänar pengar på ränta. Inlåningsränta får du när du sparar – det är bankens betalning till dig. Utlåningsränta betalar du när du lånar – det är din kostnad. Skillnaden kallas räntegap – det är bankens vinst. Riksbanken är statens bank och styr ekonomin med styrräntan för att motverka inflation (att priser stiger för mycket).",
                        concepts: ["Mellanhand", "Räntegap", "Inflation", "Styrränta"],
                        mustKnow: ["Banken som mellanhand.", "Vad räntegapet är.", "Riksbankens uppgift."],
                        summary: ["Banken kopplar ihop sparare och lånare.", "Ränta är priset på pengar.", "Riksbanken styr styrräntan."],
                        test: [{q: "Vad kallas bankens vinst?", a: "Räntegap"}, {q: "Vilken bank är statens bank?", a: "Riksbanken"}],
                        reasoning: "Hur påverkas en familj om räntan stiger?",
                        application: "Räkna ut räntegapet om in- är 2% och ut- är 7%."
                    },
                    {
                        title: "B: Utbud & Efterfrågan", page: "54-55",
                        text: "Boksida: 54-55\n\nPriset på nästan allt bestäms av utbud och efterfrågan. Utbud är hur mycket det finns av en vara till försäljning. Efterfrågan är hur många som vill köpa den. I början av sommaren är jordgubbar dyra för att utbudet är litet men efterfrågan hög. När det mognar massor sjunker priset för att locka köpare. Marknadspriset skapas där säljare och köpare möts. Om efterfrågan ökar (t.ex. genom reklam) stiger priset igen. Om ingen vill ha en vara sjunker priset jättemycket för att affären ska bli av med den.",
                        concepts: ["Utbud", "Efterfrågan", "Marknadspris", "Jämvikt"],
                        mustKnow: ["Definitionen av utbud.", "Definitionen av efterfrågan.", "Hur priset stiger/sjunker."],
                        summary: ["Priset styrs av tillgång och sug.", "Litet utbud = dyrt.", "Stort utbud = billigt."],
                        test: [{q: "Vad kallas mängden varor som finns?", a: "Utbud"}, {q: "Vad händer om suget ökar?", a: "Priset stiger"}],
                        reasoning: "Varför sänker affärer priset under REA?",
                        application: "Ge ett exempel på en vara där priset ändras ofta."
                    }
                ]
            },
            {
                id: 4, title: "Block 4: Lag & Rätt", icon: "scale", sections: [
                    {
                        title: "A: Rättskedjan", page: "62-63",
                        text: "Boksida: 62-63\n\nNär ett brott har begåtts börjar rättskedjan. Den börjar hos polisen som utreder vad som hänt och säkrar bevis. Om polisen tror att de hittat den skyldige tar åklagaren över. Åklagaren beslutar om bevisen räcker för rättegång. I domstolen (tingsrätten) dömer en domare och tre nämndemän. Nämndemännen är vanliga människor som representerar folket. Den misstänkte kallas tilltalad och har rätt till försvarare. Om personen döms får hen en påföljd (straff), som böter eller fängelse. För unga mellan 15 och 18 år används ofta ungdomsvård istället för fängelse.",
                        concepts: ["Åklagare", "Nämndeman", "Påföljd", "Tilltalad"],
                        mustKnow: ["Stegen i rättskedjan.", "Vad en nämndeman är.", "Att påföljd betyder straff."],
                        summary: ["Polisen utreder, domstolen dömer.", "Nämndemän är vanliga medborgare.", "Påföljd = straff."],
                        test: [{q: "Vem utreder brott?", a: "Polisen"}, {q: "Vem beslutar om åtal?", a: "Åklagaren"}],
                        reasoning: "Varför har vi nämndemän i domstolen?",
                        application: "Rita upp stegen i rättskedjan."
                    },
                    {
                        title: "B: Skollagen & Mobbning", page: "24-25",
                        text: "Boksida: 24-25\n\nSkollagen säger att alla barn har rätt att känna sig trygga i skolan. Mobbning kallas för 'kränkande behandling'. Det kan vara fysiskt (slag), psykiskt (utfrysning) eller verbalt (elaka ord). Rektorn har huvudansvaret för tryggheten. All personal har anmälningsplikt, vilket betyder att de måste berätta för rektorn direkt om de hör att en elev mår dåligt. Det är alltid den utsatta som avgör om det är en kränkning, inte den som utför den. Varje skola måste ha en plan mot kränkningar som uppdateras varje år.",
                        concepts: ["Kränkning", "Anmälningsplikt", "Skollagen", "Huvudman"],
                        mustKnow: ["Tre typer av kränkning.", "Anmälningsplikten.", "Offrets tolkningsföreträde."],
                        summary: ["Skollagen skyddar dig.", "Vuxna måste ingripa direkt.", "Offret avgör om det är fel."],
                        test: [{q: "Vad kallas mobbning i lagen?", a: "Kränkande behandling"}, {q: "Vem har huvudansvaret?", a: "Rektorn"}],
                        reasoning: "Varför är det viktigt att vuxna har anmälningsplikt?",
                        application: "Ge tre förslag på hur skolan kan bli tryggare."
                    }
                ]
            },
            {
                id: 5, title: "Block 5: Demokrati", icon: "users", sections: [
                    {
                        title: "A: Vad är demokrati?", page: "75",
                        text: "Boksida: 75\n\nOrdet demokrati kommer från grekiskans 'demos' (folk) och 'kratos' (styre). Det betyder alltså folkstyre. I en demokrati utgår all makt från folket. I Sverige har vi representativ demokrati. Det betyder att vi väljer representanter (politiker) som vi litar på till riksdag, region och kommun. Dessa fattar sedan besluten åt oss. Det finns också direkt demokrati, som när vi röstar genom handuppräckning i klassrummet. Demokratin startade i antikens Aten för 2500 år sedan. Där fick alla fria män rösta direkt. Men det var ingen perfekt demokrati – kvinnor, slavar och utlänningar fick inte vara med. Idag kämpar vi för att alla vuxna ska ha samma rätt att bestämma.",
                        concepts: ["Folkstyre", "Representativ", "Direkt demokrati", "Antikens Aten"],
                        mustKnow: ["Ordets ursprung och betydelse.", "Skillnaden på direkt och representativ.", "Vem som fick rösta i Aten."],
                        summary: ["Demokrati = Folkstyre.", "Sverige väljer representanter.", "Aten var demokratins födelseplats."],
                        test: [{q: "Vad betyder 'demos'?", a: "Folk"}, {q: "Vilken typ har Sverige?", a: "Representativ"}],
                        reasoning: "Varför röstar vi inte om allt via mobilen varje dag?",
                        application: "Ge ett exempel på direkt demokrati i skolan."
                    },
                    {
                        title: "B: Spelregler & Pelare", page: "76-77",
                        text: "Boksida: 76-77\n\nFör att ett land ska få kallas för en demokrati krävs mer än bara val. Det finns fyra viktiga spelregler: \n1. Fria och hemliga val: Ingen får veta vad du röstar på och ingen får tvinga dig. \n2. Yttrandefrihet: Du har rätt att tycka, tänka och skriva vad du vill utan att bli straffad. \n3. Rättssäkerhet: Lagen gäller lika för alla. Man kan inte fängslas utan en rättvis rättegång. \n4. Majoritetsprincipen: Det förslag som får flest röster vinner, men man måste skydda minoriteter så att de inte förtrycks av majoriteten. Utan dessa delar är det ingen riktig demokrati även om man håller val.",
                        concepts: ["Hemliga val", "Yttrandefrihet", "Rättssäkerhet", "Minoritet"],
                        mustKnow: ["De fyra grundpelarna.", "Varför valen ska vara hemliga.", "Vad majoritetsprincipen innebär."],
                        summary: ["Fria val och yttrandefrihet krävs.", "Lagen skyddar alla.", "Minoriteten har också rättigheter."],
                        test: [{q: "Måste man berätta vad man röstat på?", a: "Nej"}, {q: "Vem bestämmer i en röstning?", a: "Majoriteten"}],
                        reasoning: "Vad händer om valen inte vore hemliga?",
                        application: "Gör en checklista för ett demokratiskt land."
                    },
                    {
                        title: "C: Diktatur - Motsatsen", page: "78-79",
                        text: "Boksida: 78-79\n\nI en diktatur är det en person (diktator) eller en liten grupp som har all makt. I en diktatur fungerar samhället genom kontroll och rädsla. Staten kontrollerar TV, tidningar och internet genom censur. Man får inte kritisera ledarna utan att riskera straff. Polisen och domstolen lyder under diktatorn. Människor vågar ofta inte säga vad de tycker ens till sina vänner. Många diktaturer försöker dölja att de är diktaturer genom att kalla sig 'demokratiska', men om folket inte har yttrandefrihet är det ingen demokrati.",
                        concepts: ["Diktator", "Censur", "Rättsosäkerhet", "Rädsla"],
                        mustKnow: ["Kännetecken för en diktatur.", "Hur censur används som maktmedel.", "Skillnaden mot rättssäkerhet."],
                        summary: ["En ledare bestämmer allt.", "Ingen yttrandefrihet.", "Staten styr media och domstolar."],
                        test: [{q: "Vad kallas kontroll av TV?", a: "Censur"}, {q: "Vem styr domstolen i en diktatur?", a: "Diktatorn"}],
                        reasoning: "Varför förbjuder diktaturer ofta sociala medier?",
                        application: "Jämför en dag i en skola i en diktatur mot en i en demokrati."
                    },
                    {
                        title: "D: FN & Mänskliga rättigheter", page: "80-81",
                        text: "Boksida: 80-81\n\nDemokrati hänger tätt ihop med mänskliga rättigheter. FN (Förenta Nationerna) skapades för att skydda människor i hela världen. De skrev ner regler som kallas för den allmänna förklaringen om de mänskliga rättigheterna. Några av de viktigaste är att alla människor är födda fria och lika i värde, att ingen får torteras och att alla har rätt till utbildning. För barn finns även Barnkonventionen. Den säger att barnets bästa alltid ska komma i första hand. Att leva i en demokrati innebär också ett ansvar – att vi respekterar varandras olikheter även när vi inte håller med.",
                        concepts: ["FN", "Barnkonventionen", "Lika värde", "Ansvar"],
                        mustKnow: ["Att MR gäller alla människor.", "Några exempel på rättigheter.", "Barnkonventionens roll."],
                        summary: ["MR skyddar individen.", "FN har skapat de globala reglerna.", "Barn har särskilda rättigheter."],
                        test: [{q: "Vad står FN för?", a: "Förenta Nationerna"}, {q: "Vilka gäller MR för?", a: "Alla människor"}],
                        reasoning: "Kan man ha en demokrati utan mänskliga rättigheter?",
                        application: "Välj en rättighet och förklara varför den är viktig."
                    }
                ]
            },
            {
                id: 6, title: "Block 6: Riksdag & Regering", icon: "landmark", sections: [
                    {
                        title: "A: Riksdagen", page: "84-85",
                        text: "Boksida: 84-85\n\nRiksdagen är folkets främsta företrädare och hjärtat i vår demokrati. Varje fjärde år väljer folket 349 ledamöter till riksdagen. Riksdagens två viktigaste uppgifter är att stifta lagar och att besluta om statens budget. Budgeten är en plan för hur alla våra skattepengar ska användas, till exempel till skola, polis och sjukhus. Riksdagen kontrollerar också att regeringen sköter sitt jobb. För att ett förslag ska bli lag måste en majoritet i riksdagen rösta ja till det. Det är i riksdagen som de stora politiska debatterna äger rum.",
                        concepts: ["Ledamot", "Budget", "Majoritet", "Stifta lagar"],
                        mustKnow: ["Antal ledamöter (349).", "Riksdagens två huvuduppgifter.", "Hur ofta det är val."],
                        summary: ["Riksdagen representerar folket.", "De bestämmer om lagar och pengar.", "De kontrollerar regeringen."],
                        test: [{q: "Hur många sitter i riksdagen?", a: "349"}, {q: "Vem väljer ledamöterna?", a: "Folket"}],
                        reasoning: "Varför bestämmer riksdagen över pengarna?",
                        application: "Namnge tre partier i riksdagen."
                    },
                    {
                        title: "B: Regeringen", page: "85-86",
                        text: "Boksida: 85-86\n\nRegeringen har till uppgift att styra landet. De ska se till att de beslut som riksdagen har fattat blir verklighet i samhället. Regeringen leds av statsministern, som väljer ut sina ministrar. Det finns ministrar för olika områden, till exempel en utbildningsminister och en finansminister. Sverige styrs genom parlamentarism, vilket betyder att regeringen måste ha stöd av riksdagen för att få styra. Regeringen lämnar förslag på lagar (propositioner) till riksdagen. Regeringen styr också statliga myndigheter som Polisen och Skolverket.",
                        concepts: ["Statsminister", "Minister", "Parlamentarism", "Proposition"],
                        mustKnow: ["Statsministerns roll.", "Skillnad på riksdag och regering.", "Vad en proposition är."],
                        summary: ["Regeringen genomför besluten.", "Statsministern leder ministrarna.", "Regeringen lämnar förslag (propositioner)."],
                        test: [{q: "Vem leder regeringen?", a: "Statsministern"}, {q: "Vem väljer ministrarna?", a: "Statsministern"}],
                        reasoning: "Vad händer om riksdagen slutar lita på regeringen?",
                        application: "Hitta vem som är statsminister nu."
                    },
                    {
                        title: "C: Från förslag till lag", page: "86",
                        text: "Boksida: 86\n\nAtt skapa en ny lag tar tid. Det börjar med ett förslag. Om förslaget kommer från regeringen kallas det proposition. Om det kommer från en ledamot kallas det motion. Förslaget skickas först till ett utskott, där experter (ledamöter) förbereder beslutet. Sedan debatteras frågan i kammaren innan riksdagen röstar. Om en majoritet röstar ja skickas beslutet till regeringen som ser till att lagen börjar gälla. Myndigheterna får då veta vad som har ändrats.",
                        concepts: ["Motion", "Utskott", "Betänkande", "Verkställa"],
                        mustKnow: ["Skillnad på proposition och motion.", "Utskottens roll.", "Stegen i lagstiftningen."],
                        summary: ["Proposition = Regering, Motion = Ledamot.", "Utskotten förbereder besluten.", "Majoriteten avgör."],
                        test: [{q: "Vad är en proposition?", a: "Förslag från regeringen"}, {q: "Var arbetar experterna?", a: "I utskotten"}],
                        reasoning: "Varför skickas förslag till utskott istället för att rösta direkt?",
                        application: "Hitta på en egen 'klassmotion'."
                    },
                    {
                        title: "D: Grundlagarna", page: "87",
                        text: "Boksida: 87\n\nSverige har fyra grundlagar som skyddar demokratin. De är extra svåra att ändra – det krävs två riksdagsbeslut med ett val emellan. Grundlagarna är: \n1. Regeringsformen: Den viktigaste lagen, beskriver hur Sverige styrs och våra rättigheter. \n2. Successionsordningen: Bestämmer vem som blir kung eller drottning. \n3. Tryckfrihetsförordningen: Rätten att skriva fritt i tidningar och böcker. \n4. Yttrandefrihetsgrundlagen: Rätten att tycka vad man vill i radio, TV och på nätet. \nSverige är en konstitutionell monarki – kungen har ingen politisk makt.",
                        concepts: ["Grundlag", "Regeringsformen", "Succession", "Monarki"],
                        mustKnow: ["De fyra grundlagarna.", "Varför de är svåra att ändra.", "Statschefens roll."],
                        summary: ["Grundlagar skyddar demokratin.", "Ändras bara med val emellan.", "Regeringsformen styr styret."],
                        test: [{q: "Vilken grundlag är viktigast?", a: "Regeringsformen"}, {q: "Hur många grundlagar har vi?", a: "Fyra"}],
                        reasoning: "Varför är de svåra att ändra?",
                        application: "Gör ett schema över grundlagarna."
                    }
                ]
            },
            {
                id: 7, title: "Block 7: Framtiden", icon: "briefcase", sections: [
                    {
                        title: "A: Samhällsförändring", page: "29–30",
                        text: "Boksida: 29–30\n\nArbetsmarknaden i Sverige har ändrats enormt. För 200 år sedan jobbade nästan alla svenskar med jordbruk. Man bodde på landet och tillverkade det mesta själv. När industrialiseringen kom byggdes fabriker och folk flyttade till städerna. Idag lever vi i ett tjänstesamhälle där de flesta jobbar inom vård, skola, handel eller teknik. Utbildning har blivit mycket viktigare för att få ett jobb idag än förr. Vi tillverkar inte allt själva längre utan köper tjänster av varandra för att underlätta vardagen. Vi lever i en tid där samhället ändras snabbare än någonsin tidigare.",
                        concepts: ["Industrialisering", "Tjänstesamhälle", "Utbildning", "Arbetsmarknad"],
                        mustKnow: ["Från jordbruk till tjänster.", "Vikten av utbildning idag.", "Städernas växt."],
                        summary: ["Förr jobbade folk med jordbruk.", "Idag jobbar de flesta med tjänster.", "Jobben kräver mer kunskap idag."],
                        test: [{q: "Vad jobbade folk med förr?", a: "Jordbruk"}, {q: "Vad kallas dagens samhälle?", a: "Tjänstesamhälle"}],
                        reasoning: "Hur såg dina morföräldrars jobb ut?",
                        application: "Intervjua en vuxen om deras första jobb."
                    },
                    {
                        title: "B: Robotar & Mekanisering", page: "31-32",
                        text: "Boksida: 31-32\n\nTekniken ändrar jobben genom mekanisering (maskiner tar tunga lyft) och digitalisering (datorer styr). Robotar finns i fabriker och jobbar dygnet runt utan att bli trötta. En robot behöver inte fika, sova eller ha semester. Det gör att varor kan tillverkas snabbare och billigare. Men det betyder också att många tunga och farliga jobb försvinner. Samtidigt skapas nya jobb för de som kan bygga och programmera robotarna. Tekniken gör oss effektivare men kräver att vi lär oss nya saker hela tiden för att kunna jobba ihop med maskinerna.",
                        concepts: ["Mekanisering", "Robotisering", "Automatisering", "Effektivitet"],
                        mustKnow: ["Vad mekanisering betyder.", "Fördelar med robotar.", "Att nya jobb skapas."],
                        summary: ["Maskiner tar tunga lyft.", "Robotar jobbar dygnet runt.", "Nya jobb kräver teknik-kunskap."],
                        test: [{q: "Varför gillar fabriker robotar?", a: "De blir inte trötta"}, {q: "Vad kallas maskinhjälp?", a: "Mekanisering"}],
                        reasoning: "Finns det jobb som en robot aldrig kan göra?",
                        application: "Leta efter en robot i din vardag."
                    },
                    {
                        title: "C: Digitalisering & AI", page: "33–34",
                        text: "Boksida: 33–34\n\nDigitalisering handlar om att datorer och smarta program styr maskinerna och vår vardag. En enorm förändring är AI (artificiell intelligens). AI är datorprogram som kan lära sig saker och lösa problem, nästan som en mänsklig hjärna. AI används redan i sjukvården för att hitta sjukdomar, som hudcancer, och styr självkörande bilar. Yrken med mänsklig kontakt (lärare, frisör) kommer finnas kvar, men verktygen de använder kommer ändras. AI hjälper oss att bli snabbare men vi måste fortfarande förstå hur tekniken fungerar så att vi kan styra den rätt.",
                        concepts: ["AI", "Algoritmer", "Diagnos", "Digitalisering"],
                        mustKnow: ["Vad AI står för.", "AI i sjukvården.", "Yrken som blir kvar."],
                        summary: ["AI lär sig av data.", "AI hjälper läkare.", "Människor behövs för empati."],
                        test: [{q: "Vad står AI för?", a: "Artificiell intelligens"}, {q: "Var används AI redan?", a: "Sjukvården"}],
                        reasoning: "Kommer en robot kunna vara din lärare?",
                        application: "Ge exempel på AI i din vardag (t.ex. Siri/Google)."
                    },
                    {
                        title: "D: Barn & Arbete", page: "40",
                        text: "Boksida: 40\n\nI Sverige skyddas barn av arbetsmiljölagen. Barn får aldrig ha farliga jobb eller jobb som hindrar skolan. Innan 13 år får man bara göra lätta jobb (sälja jultidningar, plocka bär) med föräldrars lov. Mellan 13 och 15 år får man ha lättare extrajobb men inte på natten. FN:s barnkonvention förbjuder barnarbete, men i vissa länder tvingas barn ändå jobba i gruvor istället för att gå i skolan. Vi har lagar för att se till att barn får vara barn.",
                        concepts: ["Arbetsmiljölagen", "Barnarbete", "Rättigheter", "Barnkonventionen"],
                        mustKnow: ["Lagar för barn i Sverige.", "Skolan går först.", "Barnkonventionen."],
                        summary: ["Lagar skyddar barn i Sverige.", "Skolan är viktigast.", "Barnarbete är förbjudet."],
                        test: [{q: "Vilken lag skyddar barn?", a: "Arbetsmiljölagen"}, {q: "Får en 11-åring jobba i gruva?", a: "Nej"}],
                        reasoning: "Varför finns lagar om barns arbete?",
                        application: "Lista tre säkra jobb för en 13-åring."
                    }
                ]
            }
        ];

        function App() {
            const [activeBlock, setActiveBlock] = useState(0);
            const [activeSection, setActiveSection] = useState(0);
            const [aiChat, setAiChat] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [splitPercent, setSplitPercent] = useState(55);
            const [isTeacherMode, setIsTeacherMode] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [history, setHistory] = useState([]);
            const [showDetail, setShowDetail] = useState(null);

            const splitRef = useRef(null);
            const isDragging = useRef(false);

            const block = BLOCKS[activeBlock] || BLOCKS[0];
            const section = block.sections[activeSection] || block.sections[0];

            const onStartDragging = (e) => { isDragging.current = true; document.body.style.cursor = 'ns-resize'; e.preventDefault(); };
            const onEndDragging = () => { isDragging.current = false; document.body.style.cursor = 'default'; };
            const onDragging = (e) => {
                if (!isDragging.current) return;
                const rect = splitRef.current.getBoundingClientRect();
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const y = clientY - rect.top;
                let p = (y / rect.height) * 100;
                if (p < 15) p = 15; if (p > 85) p = 85;
                setSplitPercent(p);
            };

            const askAI = async (type, queryText = "") => {
                if (isLoading) return;
                setIsLoading(true);
                const userMsg = { role: 'user', content: queryText || (type === 'simplify' ? 'Förenkla' : type === 'deepen' ? 'Fördjupa' : 'Exempel') };
                setAiChat(prev => [...prev, userMsg]);

                let sysPrompt = "";
                let q = "";

                if (type === 'simplify') {
                    sysPrompt = `Du är en pedagogisk assistent för 12-åringar. DIN TEXTBANK: "${section.text}" (Sida ${section.page}). DITT UPPDRAG: Förenkla språket extremt mycket. REGLER: 1) Skriv KORTA stycken. 2) Använd PUNKTLYSTOR om möjligt. 3) Förklara svåra ord direkt. 4) Använd bara fakta från texten. 5) Sluta med "Källa: sida ${section.page}".`;
                    q = "Gör texten jättelätt att förstå. Skriv kort och tydligt.";
                } else if (type === 'deepen') {
                    sysPrompt = `Du är en avancerad pedagogisk coach. DIN TEXTBANK: "${section.text}" (Sida ${section.page}). DITT UPPDRAG: Fördjupa förståelsen. REGLER: 1) Fokusera på SAMBAND (varför leder A till B?). 2) Diskutera KONSEKVENSER för individ och samhälle. 3) Ställ en utmanande följdfråga. 4) Använd bara fakta från texten. 5) Sluta med "Källa: sida ${section.page}".`;
                    q = "Hjälp mig fördjupa mig i samband och konsekvenser i texten.";
                } else {
                    sysPrompt = `Du är Studiekompisen AI för årskurs 6. Du svarar pedagogiskt utifrån texten. DIN TEXTBANK: "${section.text}" (Sida ${section.page}). REGLER: 1) Endast fakta från textbanken. 2) Coacha med frågor. 3) Sluta med "Källa: sida ${section.page}".`;
                    q = queryText || (type === 'concept' ? `Förklara begreppet '${queryText}' utifrån texten.` : "Ge ett vardagligt exempel på innehållet.");
                }

                try {
                    const res = await fetch(`/.netlify/functions/gemini`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ q, systemPrompt: sysPrompt, model: MODEL })
                    });
                    
                    if (!res.ok) {
                        const errText = await res.text();
                        throw new Error(`Kunde inte ansluta: ${res.status}`);
                    }
                    
                    const data = await res.json();
                    const aiResponse = data.candidates?.[0]?.content?.parts?.[0]?.text || "Hoppsan, AI:n gav inget svar. Prova igen!";
                    
                    setAiChat(prev => [...prev, { role: 'ai', content: aiResponse }]);
                    setHistory(prev => [...prev, { s: section.page, q: q, a: aiResponse }]);
                } catch (err) {
                    setAiChat(prev => [...prev, { role: 'ai', content: `Kunde inte hämta ett svar från AI-motorn (${err.message}). Se till att appen körs via Netlify och att GEMINI_API_KEY är inställd.` }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="flex w-full h-full text-left" onMouseMove={onDragging} onMouseUp={onEndDragging} onTouchMove={onDragging} onTouchEnd={onEndDragging}>
                    
                    {/* SIDEBAR */}
                    <aside className={`bg-white border-r flex flex-col shrink-0 z-50 sidebar-transition ${isSidebarOpen ? 'w-80 opacity-100' : 'w-0 opacity-0 overflow-hidden'}`}>
                        <div className="p-8 bg-indigo-700 text-white flex flex-col items-start text-left">
                            <div className="flex items-center gap-3">
                                <span className="bg-white p-2 rounded-lg text-indigo-700"><i data-lucide="graduation-cap"></i></span>
                                <h1 className="text-xl font-black uppercase italic leading-none">Studiekompisen</h1>
                            </div>
                            <p className="text-[10px] mt-2 opacity-70 uppercase font-bold tracking-widest text-left">Utkik SO Åk 6</p>
                        </div>
                        <nav className="flex-1 p-4 overflow-y-auto custom-scrollbar space-y-1 text-left">
                            {BLOCKS.map((b, i) => (
                                <button key={i} onClick={() => { setActiveBlock(i); setActiveSection(0); setAiChat([]); setShowDetail(null); }}
                                    className={`w-full flex items-center gap-3 p-4 rounded-2xl transition-all font-bold text-xs ${activeBlock === i ? 'bg-indigo-50 text-indigo-700' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    <span className="p-2 bg-slate-100 rounded-lg"><i data-lucide={b.icon} className="w-4 h-4 text-left"></i></span>
                                    <span className="whitespace-nowrap">{b.title}</span>
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t">
                            <button onClick={() => setIsTeacherMode(!isTeacherMode)} className="w-full p-3 rounded-xl bg-slate-50 text-slate-400 text-[10px] font-black uppercase tracking-widest flex justify-between items-center text-left">
                                Lärarlogg <i data-lucide={isTeacherMode ? "eye" : "eye-off"} className="w-3 h-3 text-left text-left"></i>
                            </button>
                        </div>
                    </aside>

                    {/* MAIN CONTENT AREA */}
                    <main className="flex-1 flex flex-col relative bg-white overflow-hidden text-left" ref={splitRef}>
                        <header className="bg-white/90 border-b p-4 flex items-center justify-between z-10 shrink-0 text-left">
                            <div className="flex items-center gap-4 overflow-hidden text-left">
                                <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="p-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-slate-600 shrink-0"><i data-lucide={isSidebarOpen ? "panel-left-close" : "panel-left-open"}></i></button>
                                <div className="flex gap-2 overflow-x-auto no-scrollbar text-left">
                                    {block.sections.map((s, i) => (
                                        <button key={i} onClick={() => { setActiveSection(i); setAiChat([]); setShowDetail(null); }}
                                            className={`px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest whitespace-nowrap transition-all ${activeSection === i ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-400 hover:bg-slate-200'}`}>
                                            {s.title}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="bg-indigo-50 text-indigo-600 px-4 py-1.5 rounded-full text-[10px] font-black uppercase whitespace-nowrap border border-indigo-100 ml-2">Sida {section.page}</div>
                        </header>

                        <div className="split-container text-left">
                            <div className="panel-text custom-scrollbar text-left" style={{ flexBasis: `${splitPercent}%` }}>
                                <div className="max-w-4xl mx-auto p-8 space-y-12 pb-20 text-left">
                                    <section className="bg-amber-50 p-10 rounded-[3rem] border-4 border-amber-100 shadow-xl relative overflow-hidden text-left">
                                        <h4 className="text-[10px] font-black text-amber-700 uppercase tracking-widest mb-6 flex items-center gap-2 italic text-left">
                                            <i data-lucide="check-circle-2" className="w-4 h-4 text-left"></i> Detta behöver du kunna
                                        </h4>
                                        <ul className="space-y-3">{section.mustKnow.map((m, i) => <li key={i} className="flex gap-4 font-bold text-amber-900 leading-snug text-left text-left"><span className="text-amber-400">▶</span> {m}</li>)}</ul>
                                    </section>

                                    <section className="bg-white p-12 rounded-[4rem] shadow-2xl border border-slate-100 relative animate-fade-in text-left text-left text-left">
                                        <div className="absolute top-0 left-0 w-2 h-full bg-indigo-600"></div>
                                        <p className="text-2xl leading-[1.8] text-slate-700 font-bold whitespace-pre-wrap text-left text-left">{section.text}</p>
                                        <div className="mt-14 pt-10 border-t-2 border-slate-50 text-left">
                                            <p className="text-[10px] font-black text-slate-400 uppercase mb-5 text-left text-left">Begrepp (klicka för förklaring):</p>
                                            <div className="flex flex-wrap gap-2 text-left text-left">{section.concepts.map((c, i) => <button key={i} onClick={() => askAI('concept', c)} className="px-5 py-2.5 bg-indigo-50 text-indigo-700 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-indigo-600 hover:text-white transition-all border border-indigo-100 text-left">{c}</button>)}</div>
                                        </div>
                                    </section>

                                    <section className="grid grid-cols-1 md:grid-cols-3 gap-6 font-black uppercase text-[10px] tracking-widest text-left text-left">
                                        <button onClick={() => setShowDetail('summary')} className="p-10 rounded-[2.5rem] border-4 border-slate-100 bg-white text-slate-400 flex flex-col items-center gap-4 hover:border-indigo-200 transition-all text-center"><i data-lucide="list-checks" className="w-10 h-10 text-left"></i> Sammanfattning</button>
                                        <button onClick={() => setShowDetail('test')} className="p-10 rounded-[2.5rem] border-4 border-slate-100 bg-white text-slate-400 flex flex-col items-center gap-4 hover:border-blue-200 transition-all text-center"><i data-lucide="zap" className="w-10 h-10 text-left text-left text-left"></i> Självtest</button>
                                        <button onClick={() => setShowDetail('reasoning')} className="p-10 rounded-[2.5rem] border-4 border-slate-100 bg-white text-slate-400 flex flex-col items-center gap-4 hover:border-emerald-200 transition-all text-center"><i data-lucide="brain-circuit" className="w-10 h-10 text-left text-left text-left"></i> Resonera</button>
                                    </section>

                                    {showDetail && (
                                        <div className="bg-slate-50 p-12 rounded-[3.5rem] border-2 border-slate-100 animate-fade-in text-left text-left">
                                            {showDetail === 'summary' && <ul className="space-y-4 text-left text-left">{section.summary.map((s, i) => <li key={i} className="bg-white p-7 rounded-3xl font-bold flex gap-5 shadow-sm border border-slate-100 text-left text-left text-left text-left text-left"><span className="text-indigo-500 font-black">0${i+1}</span>{s}</li>)}</ul>}
                                            {showDetail === 'test' && <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-left text-left">{section.test.map((t, i) => <div key={i} className="bg-white p-6 rounded-3xl border border-blue-50 shadow-sm flex flex-col justify-between italic text-sm font-black text-slate-800 text-left text-left">"{t.q}"<button onClick={(e) => { e.currentTarget.innerHTML = `<span class='text-blue-600 font-black'>${t.a}</span>`; }} className="text-[9px] text-blue-300 uppercase mt-4 text-left text-left">Visa svar</button></div>)}</div>}
                                        </div>
                                    )}

                                    <section className="bg-slate-900 text-white p-12 rounded-[4rem] shadow-2xl relative overflow-hidden group text-left text-left text-left">
                                        <h4 className="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-6 italic text-left text-left">Tillämpning: Gör detta nu</h4>
                                        <p className="text-2xl font-bold leading-snug tracking-tight text-left text-left">{section.application || "Läs i boken och svara på frågorna."}</p>
                                    </section>
                                </div>
                            </div>

                            <div className="drag-handle" onMouseDown={onStartDragging} onTouchStart={onStartDragging}></div>

                            <div className="panel-ai custom-scrollbar p-8 text-left text-left text-left">
                                <div className="max-w-4xl mx-auto w-full space-y-6 text-left">
                                    <div className="flex gap-3 overflow-x-auto no-scrollbar pb-1 text-left text-left">
                                        <button onClick={() => askAI('simplify')} className="bg-blue-600 text-white px-6 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center gap-3 shadow-lg shrink-0 text-left text-left"><i data-lucide="sparkles" className="w-4 h-4 text-left text-left"></i> Förenkla texten</button>
                                        <button onClick={() => askAI('deepen')} className="bg-emerald-600 text-white px-6 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center gap-3 shadow-lg shrink-0 text-left text-left"><i data-lucide="brain" className="w-4 h-4 text-left text-left text-left"></i> Fördjupa & samband</button>
                                        <button onClick={() => askAI('example')} className="bg-slate-900 text-white px-6 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center gap-3 shadow-lg shrink-0 text-left text-left text-left"><i data-lucide="message-square" className="w-4 h-4 text-left text-left text-left text-left"></i> Ge exempel</button>
                                    </div>
                                    {aiChat.map((m, i) => (
                                        <div key={i} className={`flex ${m.role === 'user' ? 'justify-end text-right text-left text-left' : 'justify-start text-left text-left text-left text-left'} animate-fade-in`}>
                                            <div className={`max-w-[85%] p-7 rounded-[2rem] text-sm font-bold shadow-xl leading-relaxed ${m.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none text-right text-left text-left text-left' : 'bg-white border-2 border-slate-50 text-slate-800 rounded-tl-none text-left text-left'}`}>
                                                {m.role === 'ai' && <div className="text-[9px] uppercase tracking-widest text-indigo-500 mb-3 font-black opacity-60 text-left text-left text-left text-left">Studiekompisen AI</div>}
                                                <div className="whitespace-pre-wrap text-left text-left text-left text-left">{m.content}</div>
                                            </div>
                                        </div>
                                    ))}
                                    {isLoading && <div className="flex justify-start text-left text-left text-left text-left text-left"><div className="bg-white p-6 rounded-[2rem] flex items-center gap-5 shadow-xl text-left text-left text-left text-left text-left text-left"><div className="w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin text-left text-left text-left text-left"></div><span className="text-[10px] font-black text-indigo-400 uppercase animate-pulse italic text-left text-left text-left text-left">Studerar boken...</span></div></div>}
                                </div>
                            </div>
                        </div>
                    </main>

                    {isTeacherMode && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-2xl z-[100] flex items-center justify-center p-10 text-left text-left text-left text-left text-left">
                            <div className="bg-white w-full max-w-6xl h-[90vh] rounded-[5rem] flex flex-col overflow-hidden border-4 border-white shadow-2xl text-left text-left text-left text-left text-left text-left">
                                <header className="p-14 border-b flex justify-between items-center bg-slate-50/50 text-left text-left">
                                    <h2 className="text-4xl font-black uppercase italic text-slate-900 leading-none text-left text-left text-left">Kontrollpanel</h2>
                                    <button onClick={() => setIsTeacherMode(false)} className="bg-white p-5 rounded-full border-2 border-slate-100 hover:text-red-500 transition-all shadow-sm text-left text-left text-left"><i data-lucide="x"></i></button>
                                </header>
                                <div className="flex-1 overflow-y-auto p-14 custom-scrollbar text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                    <table className="w-full text-left text-left text-left text-left text-left text-left text-left">
                                        <thead className="bg-slate-50 text-[11px] font-black text-slate-500 uppercase italic border-b-4 border-white text-left text-left text-left text-left text-left"><tr><th className="p-10 text-left text-left">Sida</th><th className="p-10 text-left text-left text-left text-left">Input</th><th className="p-10 text-left text-left text-left text-left">Svar</th></tr></thead>
                                        <tbody className="text-base font-bold text-slate-600 divide-y-4 divide-slate-50 text-left text-left text-left text-left text-left text-left">
                                            {history.map((h, i) => (
                                                <tr key={i} className="hover:bg-indigo-50/30 transition-colors text-left text-left text-left text-left text-left">
                                                    <td className="p-10 text-xs font-black italic whitespace-nowrap text-left text-left text-left text-left text-left">SIDA {h.s}</td>
                                                    <td className="p-10 italic text-slate-900 text-lg text-left text-left text-left text-left text-left">"{h.q}"</td>
                                                    <td className="p-10 text-sm font-medium opacity-60 leading-relaxed max-w-lg text-left text-left text-left text-left text-left">{h.a}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        setTimeout(() => { if (window.lucide) window.lucide.createIcons(); }, 100);
    </script>
</body>
</html>
